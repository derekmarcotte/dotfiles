#!/bin/sh

usage() {
	echo "$0 [base|pathogen|colors|vim-sensible|vim-editorconfig|vim-sync|vim-go|vim-php-cs-fixer]"
	exit 1
}

pathogen_install() {
	if [ ! -d bundle ]; then
		echo "Pathogen not found, installing?"
		$0 pathogen
	fi

	cd bundle
}

#$1 plugin name
plugin_repo() {
	# poor-man's associative array
	case "$1" in
	# language-agnostic
	vim-sensible)     echo "git://github.com/tpope/vim-sensible.git" ;;
	vim-editorconfig) echo "https://github.com/editorconfig/editorconfig-vim" ;;
	vim-sync)         echo "https://github.com/eshion/vim-sync" ;;
	# language-specific
	vim-go)           echo "https://github.com/fatih/vim-go.git" ;;
	vim-php-cs-fixer) echo "https://github.com/stephpy/vim-php-cs-fixer" ;;
	*) return 1 ;;
	esac

	return 0
}

#$1 plugin name
plugin_dir() {
	case "$1" in
	# have to be special!
	vim-editorconfig) echo "editorconfig-vim" ;;
	*)                echo "$1" ;;
	esac

	return 0
}

case "$1" in
pathogen)
	# https://github.com/tpope/vim-pathogen
	mkdir autoload bundle 
	curl -LSso autoload/pathogen.vim https://tpo.pe/pathogen.vim
	;;
vim-*)
	pathogen_install

	DIR="$(plugin_dir "$1")"
	if [ -d "$DIR" ]; then
		(
			cd "$DIR"
			git pull
		)
	else
		REPO="$(plugin_repo "$1")"
		if ! [ -z "$REPO" ]; then
			git clone "$REPO"
		else
			echo "Could not find a repo matching $1"
			usage
		fi
	fi
	;;
colors)
	mkdir colors
	(
		cd colors

		# https://github.com/tomasr/molokai
		curl -OJ "https://raw.githubusercontent.com/tomasr/molokai/master/colors/molokai.vim"

		# https://github.com/noahfrederick/vim-noctu
		curl -OJ "https://raw.githubusercontent.com/noahfrederick/vim-noctu/master/colors/noctu.vim"
	)
	;;
base)
	$0 pathogen
	$0 colors
	$0 vim-sensible
	;;
wipe)
	rm -rf autoload
	rm -rf bundle
	rm -rf colors
	;;
*)
	usage
	;;
esac
